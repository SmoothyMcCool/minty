<div>
	<div class="container">
		<h1>{{assistant.name}}<ng-container *ngIf="conversation && conversation.title"> -
				{{conversation.title}}</ng-container></h1>

		<div class="row mb-2">
			<div class="col-2">
				<h2>Prompt</h2>
				<div *ngIf="!assistant.hasMemory">
					<i class="bi bi-exclamation-triangle">
						This assistant has no conversation history!
						It will only respond to the last message you send,
						and your conversation will not be saved.
					</i>
				</div>
			</div>
			<div class="col-10">
				<div class="overflow-auto well p-3" style="white-space: pre-wrap; height: 100px;">
					{{assistant.prompt}}
				</div>
			</div>
		</div>

		<div class="row mb-2 form-floating">
			<div class="col form-floating">
				<textarea style="height: 100px;" class="form-control" id="aiQuery" name="aiQuery"
					[(ngModel)]="userText"></textarea>
				<label class="ms-3" for="aiQuery">Put your input here</label>
			</div>
		</div>

		<div class="row mb-2">
			<div class="col-auto">
				<button class="btn btn-primary mb-2" (click)="submit(userText)"
					[disabled]="!userText || waitingForResponse">
					Okey Dokey
				</button>
			</div>
			<div class="col">
				<minty-image-input [imageSupport]="model && model.imageSupport" [reset]="shouldReset" (image)="onImageChanged($event)"></minty-image-input>

			</div>
			<div class="col-auto">
				<button class="btn btn-danger" (click)="restartConversation()">
					Start over
				</button>
			</div>
		</div>

		<div class="form-group mb-2" *ngIf="model">
			<minty-slider [min]="model.defaultContext" [max]="model.maximumContext" [label]="'Context Size (Smaller is sometimes faster)'" [(ngModel)]="contextSize"></minty-slider>
		</div>

		<ng-container *ngIf="sources">
			<div class="row mb-2">
				Sources Used by the last Response (Warning: source information is not preserved!):
			</div>
			<ul class="list-group">
				<li class="list-group-item list-group-item" *ngFor="let source of sources">
					{{source}}
				</li>
			</ul>
		</ng-container>

		<div class="row mb-2" *ngIf="metrics">
			<div class="col-auto">
				<strong>Request Tokens:</strong>&nbsp;{{metrics.promptTokens}}
			</div>
			<div class="col-auto">
				<strong>Response Tokens:</strong>&nbsp;{{metrics.completionTokens}}
			</div>
			<div class="col-auto">
				<strong>Total Tokens:</strong>&nbsp;{{metrics.promptTokens + metrics.completionTokens}}
			</div>
		</div>

		<div class="overflow-auto">
			<minty-conversation [messages]="chatHistory" [responsePending]="waitingForResponse"
				[queueDepth]="queueDepth"></minty-conversation>
		</div>
	</div>
</div>

<minty-confirmation-dialog [title]="'Restart Conversation'"
	[message]="'Are you sure you want to start over? You conversation history will be irretrievably lost.'"
	[visible]="confirmRestartConversationVisible" (confirm)="confirmRestartConversation()"
	(cancel)="confirmRestartConversationVisible = false">
</minty-confirmation-dialog>